---
import Analytics from '../components/Analytics.astro';

export interface Props {
  title: string;
  description?: string;
  noindex?: boolean;
  ogImage?: string;
  keywords?: string;
}

const { 
  title, 
  description = "Connecticut Business Automations - Save 10+ hours per week with custom automation solutions for small businesses in Connecticut", 
  noindex = false,
  ogImage = "/images/ct-business-automation-results.webp",
  keywords = "business automation Connecticut, CT automation services, small business automation, invoice automation, lead automation, Connecticut business solutions"
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const socialImageURL = new URL(ogImage, Astro.site);
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content={description}>
  <meta name="keywords" content={keywords}>
  {noindex && <meta name="robots" content="noindex, nofollow" />}
  {!noindex && <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />}
  <title>{title}</title>
  
  <!-- Canonical URL -->
  <link rel="canonical" href={canonicalURL} />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content={canonicalURL}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={socialImageURL}>
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:type" content="image/webp">
  <meta property="og:image:alt" content="CT Business Automations - Save 20+ Hours Every Week">
  <meta property="og:site_name" content="CT Business Automations">
  <meta property="og:locale" content="en_US">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content={canonicalURL}>
  <meta property="twitter:title" content={title}>
  <meta property="twitter:description" content={description}>
  <meta property="twitter:image" content={socialImageURL}>
  
  <!-- Additional SEO -->
  <meta name="author" content="Tom Lucia">
  <meta name="generator" content={Astro.generator}>
  
  <!-- Favicon - Complete set for all browsers and Google -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#ff6b6b">
  
  <!-- Android Chrome -->
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
  
  <!-- Fallback SVG for modern browsers -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  
  <!-- Preconnect to Google Fonts and external resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://unpkg.com">
  
  <!-- Optimized font loading with display=swap - reduced weights for mobile performance -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Crimson+Pro:wght@300;400&display=swap" rel="stylesheet">
  
  <!-- Preload hero image for faster LCP -->
  <link rel="preload" as="image" href="/tom-headshot.png">
  
  <!-- Alpine.js for interactive components - deferred loading -->
  <script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YES4872DTB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YES4872DTB');
  </script>
  
  <!-- Microsoft Clarity Analytics -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "skymuautys");
  </script>
  
  <!-- Visitor Notification Webhook - Delayed for better performance -->
  <script type="text/javascript">
    if (typeof window !== 'undefined') {
      window.addEventListener('load', function() {
        // Use requestIdleCallback if available, otherwise setTimeout
        var sendTracking = function() {
          fetch('https://hook.us2.make.com/wnazun7k3pcad00nnnv9ixmqm2xbka99', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              event: 'pageview',
              site: 'ctbusinessautomations.com',
              path: window.location.pathname,
              referrer: document.referrer || 'direct',
              mobile: /iPhone|Android/i.test(navigator.userAgent),
              timestamp: Date.now()
            })
          }).catch(function() {});
        };
        
        if ('requestIdleCallback' in window) {
          requestIdleCallback(sendTracking, { timeout: 5000 });
        } else {
          setTimeout(sendTracking, 3000);
        }
      });
    }
  </script>
</head>
<body>
  <slot />
  <Analytics />
</body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>